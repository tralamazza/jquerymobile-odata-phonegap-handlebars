<!DOCTYPE html>
<html>
    <head>
        <title>OData Viewer</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
        <meta charset="utf-8">

        <!-- jQuery & jQuery Mobile -->
        <link rel="stylesheet" href="app/style/jquery.mobile-1.0.1.min.css" />
        <script src="app/vendor/jquery-1.7.1.min.js"></script>
        <script src="app/vendor/jquery.mobile-1.0.1.min.js"></script>
        <!-- datajs -->
        <script src="app/vendor/datajs-1.0.2.min.js"></script>
        <!-- handlebars -->
        <script src="app/vendor/handlebars-1.0.0.beta.6.js"></script>
        <!-- Phonegap -->
        <script src="phonegap-1.4.0.js"></script>

        <script type="text/javascript">

            $(document).ready(function() {
                $.support.cors = true;
                $.mobile.allowCrossDomainPages = true;
                
                var lv_tmpl = Handlebars.compile('\
                    <ul data-role="listview" data-inset="true" data-filter="true" id="home-listview">\
                        {{#each results}}\
                            <li><img src={{BoxArt.MediumUrl}} /><h2>{{Name}}</h2>Rating: {{AverageRating}}</li>\
                        {{/each}}\
                    </ul>\
                ');

                loadListView(lv_tmpl, function(view) {
//                    $(view).appendTo(":jqmData(role=content)");
//                    $(":jqmData(role=page)").trigger('create');
                    $(view).appendTo("#home-content");
                    $("#home").trigger('create'); // XXX force update hack
                });
            });

            function loadListView(listview_template, fn) {
                OData.read("http://odata.netflix.com/v1/Catalog/Titles?$orderby=AverageRating desc&$top=10",
                    function(data, request) {
                        fn(listview_template(data));
                    }, function(err) {
                        fn(null, "Error occurred " + err.message);
                    }
                );
            }

        </script>
    </head>

    <body>
        <div id="pages">
            <!-- home -->
            <div data-role="page" id="home">
                <div data-role="header" id="home-header">
                    <h1>Netflix: Top 10</h1>
                </div>

                <div data-role="content" id="home-content">
                </div>
            </div>

        </div>
    </body>
</html>
